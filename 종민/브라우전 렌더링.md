# 브라우저 렌더링

## 파싱

문서를 읽고 토큰으로 분해해 트리 구조 자료구인 파스 트리로 만드는 과정

## 렌더링 과정

1. 서버로 부터 자바스크립트 HTML CSS 받기
2. HTML -> DOM, CSS -> CSSOM, 렌더트리 생성
3. 브라우저의 자바스크립트 엔진은 서버로부터 응답된 자바스크립트를 파싱하여 AST (Abstract Syntax Tree)를 생성하고 바이트 코드로 변환하여 실행. 이때 자바스크립트는 DOM API를 통해 DOM이나 CSSOM을 변경할 수 있다. 변경된 DOM과 CSSOM은 다시 렌더 트리로 결합된다.
4. 렌더 트리를 기반으로 HTML 요소의 레이아웃（위치와 크기）을 계산하고 브라우저 화면에 HTML 요소를 페인팅한다.

## HTTP

웹에서 브라우저와 서버가 통신하기 위한 프로토콜

1.1: 하나의 요청, 하나의 응답 -> 여러 리소스를 동시 전송 불가능.
2.0: 여러 리소스를 동시 전송 가능.-> 페이지로드 1.1에 비해 50% 빠름

## DOM 생성 과정

브라우저가 이해할 수 있는 자료구조
바이트 -> 문자 -> 토큰 -> 노드 -> DOM

## CSSOM 생성 과정

DOM을 생성하다가 CSS를 로드하는 link 태그나 style 태그를 만나면 DOM 생성을 일시 중단
바이트 -> 문자 -> 토큰 -> 노드 -> CSSOM
CSS 파싱을 완료하면 HTML 파싱이 중단된 지점부터 다시 HTML을 파싱하기 시작하여 DOM 생성을 재개

## 렌더트리

- 렌더링을 위한 트리 구조의 자료구조
- 브라우저 화면에 렌더링되는 노드만으로 구성
- DOM + CSSOM -> RENDER TREE -> LAY OUT(위치와 크기 계산: 리플로우) -> PAINT(픽셀 렌더링: 리 페인트)

## 자바스크립트 파싱과 실행

DOM 파싱 중 script 만나면 중지하고 자바스크립트 파싱

js -> AST -> 바이트 코드 -> 실행

## 파싱 중단

동기적으로 실행. HTML에서 script나 style 태그 위치는 중요한 의미를 갖는다.

body 요소의 가장 아래에 자바스크립트를 위치시키는 것은 좋은 아이디어

- DOM이 완성되지 않은 상태에서 자바스크립트가 DOM을 조작하면 에러가 발생할 수 있다
- 자바스크립트 로딩/파싱/실행으로 인해 HTML 요소들의 렌더링에 지장받는 일이 발생하지 않아 페이지 로딩 시간이 단축

## async/defer

파싱과 로드가 비동기적으로 실행

```html

<script async src="extern.js"x/script>
<script defer src="extern.js ></script>

```

async: js 파싱 후 html 파싱 중지하고 실행
defer: js 파싱 후 html 파싱 완료 후 실행
